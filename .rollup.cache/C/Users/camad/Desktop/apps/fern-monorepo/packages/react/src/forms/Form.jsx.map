{"version":3,"file":"Form.jsx","sourceRoot":"","sources":["Form.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { useRef } from 'react'\r\nimport Honeypot from './Honeypot'\r\nimport { cn } from '../_util'\r\n\r\nconst defaultStates = [\r\n  { id: 0, end: 0, error: 0, disabled: 0, message: 'Default state'                          },\r\n  { id: 1, end: 0, error: 0, disabled: 1, message: 'Submitting...'                          },\r\n  { id: 2, end: 0, error: 1, disabled: 0, message: 'Please correct the highlighted fields.' },\r\n  { id: 3, end: 1, error: 1, disabled: 1, message: 'Maximum number of attempts reached.'    },\r\n  { id: 4, end: 0, error: 1, disabled: 0, message: 'Server error; please retry shortly.'    },\r\n  { id: 5, end: 1, error: 0, disabled: 1, message: 'Successfully submitted. Thank you!'     },\r\n  { id: 6, end: 0, error: 0, disabled: 0, message: 'Successfully saved!'                    },\r\n]\r\n\r\ninterface Props {\r\n  className?: string\r\n  children?: any\r\n  states?: Object[]\r\n  onStateChange?: Function\r\n  onSubmit?: Function\r\n  maxAttempts?: number\r\n  maxSubmissions?: number\r\n}\r\n\r\nexport default function Form({\r\n  className,\r\n  children,\r\n  states = [],\r\n  onStateChange,\r\n  onSubmit,\r\n  maxAttempts = 99,\r\n  maxSubmissions = 1,\r\n}: Props) {\r\n  const attempts = useRef(0)\r\n  const submissions = useRef(0)\r\n  const formRef = useRef<any>()\r\n\r\n  const updateState = (newState: number) => {\r\n    const state = states[newState] || defaultStates[newState]\r\n\r\n    formRef.current.querySelectorAll('*').forEach((element: HTMLElement) => {\r\n      element.dispatchEvent(new CustomEvent('FernFormStateChange', { detail: { state } }))\r\n    })\r\n    \r\n    onStateChange && onStateChange(state)\r\n  }\r\n\r\n  const handleSubmit = async (e: any) => {\r\n    e.preventDefault()\r\n\r\n    if (attempts.current++ >= maxAttempts)\r\n      return updateState(3)\r\n\r\n    for (const field of e.target.elements) {\r\n      if (field.hasAttribute('data-field-valid') && field.getAttribute('data-field-valid') !== 'true')\r\n        return updateState(2)\r\n    }\r\n\r\n    updateState(1)\r\n\r\n    onSubmit && onSubmit(e)\r\n      .then(() => updateState(++submissions.current >= maxSubmissions ? 5 : 6))\r\n      .catch(() => updateState(4))\r\n  }\r\n\r\n  return (\r\n    <form\r\n      ref={formRef}\r\n      method='post'\r\n      onSubmit={handleSubmit}\r\n      className={cn('fui-form', className)}\r\n      noValidate\r\n    >\r\n      <Honeypot />\r\n      {children}\r\n    </form>\r\n  )\r\n}"]}